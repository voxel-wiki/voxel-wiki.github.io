{% extends "page.html" %}
{% block body %}{% set page_class="projects" %}{% endblock body %}
{% block content %}
<div class="wrap container" role="document">
  <div class="content">
    <div class="row justify-content-center">
      <div class="col-md-12 col-lg-10 col-xl-8">
        <article>
          <div class="page-header">
            <h1>{{ page.title }}</h1>
          </div>
          {% if page.extra.lead %}<p class="lead">{{ page.extra.lead }}</p>{% endif %}
          {{ page.content | safe }}
          
          {% set references = load_data(path="content/wiki/references.toml", format="toml") %}
          
          <p style="text-align: center">
            The source for this list can <a href="https://github.com/voxel-wiki/voxel-wiki.github.io/blob/main/content/wiki/references.toml">be found here</a>.
          </p>
          <p>
            <input id="searchinput"
              type="search"
              autocomplete="off"
              autofocus
              class="form-control is-search"
              placeholder="Search for reference..."
              aria-label="Search for reference..."
              style="display:none"
            />
          </p>
          <style>
            #references {
              display: flex;
              flex-flow: column nowrap;
              gap: 1.5rem;
              margin: 1rem 0;
            }
            #references .card-header {
              padding: 0.5rem;
            }
            #references .card-header svg {
              float: right;
              height: 2rem;
              margin-left: 0.5rem;
            }
            #references .card-title {
              margin-top: 0.25rem;
            }
            #references .card-subtitle {
              font-size: 0.75rem;
              user-select: all;
              opacity: 0.75;
              clear: both;
            }
            #references .tag {
              padding: 0.25rem;
              font-size: 0.75rem;
              user-select: all;
              color: #FF3385;
            }
            body.dark #references .card {
              background: rgba(0,0,0,0.25);
            }
            body.dark #references .card-header {
              border-bottom-color: #333;
            }
          </style>
          
          <!-- Structure of references.*:
            [SLUG]
            title = "TITLE"
            url = "URL"
            tags = [ TAGS ]
            type? = "TYPE"
          -->
          <div id=references>{% for refname, reference in references %}
            {% set reftype = reference | get(key="type", default="") %}
            {% if reference.url is matching("^(?i)http(s)?://") %}
              {% set refurla = reference.url
                  | split(pat="") | slice(start=5) | join(sep="")
                  | trim_start_matches(pat="s")
                  | split(pat="") | slice(start=4) | join(sep="")
                  | split(pat="/")
              %}
              {% set refhost = refurla | first() %}
              {% set refurla = refurla | slice(start=1) %}
              {% set refpath = refurla | join(sep="/") %}
              {% if reftype == "" and refhost is matching("^(\S+\.)wiki(pedia|media)\.org$") %}
                {% set reftype = "wikipedia" %}
              {% endif %}
            {% else %}
              {% set refhost = "" %}
              {% set refpath = "" %}
            {% endif %}
            
            <section class="card js-ref"
              data-type='{{ reftype }}'
              data-slug='{{ refname }}'
              data-url ='{{ reference.url }}'
              data-host='{{ refhost }}'
              data-host-slug='{{ refhost | slugify }}'
              data-path='/{{ refpath }}'
              data-path-slug='{{ refpath | slugify }}'
              data-tags='{{ reference | get(key="tags", default=[]) | join(sep=",") }}'
            >
              <header class="card-header {% if reference.dead %}text-decoration-line-through{% endif %}">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <title>{{reftype}}</title>
                  {% if reftype == "paper" %}
                  <path fill="currentColor" d="M6,2A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6M6,4H13V9H18V20H6V4M8,12V14H16V12H8M8,16V18H13V16H8Z" />
                  {% elif reftype == "book" %}
                  <path fill="currentColor" d="M12 21.5C10.65 20.65 8.2 20 6.5 20C4.85 20 3.15 20.3 1.75 21.05C1.65 21.1 1.6 21.1 1.5 21.1C1.25 21.1 1 20.85 1 20.6V6C1.6 5.55 2.25 5.25 3 5C4.11 4.65 5.33 4.5 6.5 4.5C8.45 4.5 10.55 4.9 12 6C13.45 4.9 15.55 4.5 17.5 4.5C18.67 4.5 19.89 4.65 21 5C21.75 5.25 22.4 5.55 23 6V20.6C23 20.85 22.75 21.1 22.5 21.1C22.4 21.1 22.35 21.1 22.25 21.05C20.85 20.3 19.15 20 17.5 20C15.8 20 13.35 20.65 12 21.5M11 7.5C9.64 6.9 7.84 6.5 6.5 6.5C5.3 6.5 4.1 6.65 3 7V18.5C4.1 18.15 5.3 18 6.5 18C7.84 18 9.64 18.4 11 19V7.5M13 19C14.36 18.4 16.16 18 17.5 18C18.7 18 19.9 18.15 21 18.5V7C19.9 6.65 18.7 6.5 17.5 6.5C16.16 6.5 14.36 6.9 13 7.5V19M14 16.35C14.96 16 16.12 15.83 17.5 15.83C18.54 15.83 19.38 15.91 20 16.07V14.57C19.13 14.41 18.29 14.33 17.5 14.33C16.16 14.33 15 14.5 14 14.76V16.35M14 13.69C14.96 13.34 16.12 13.16 17.5 13.16C18.54 13.16 19.38 13.24 20 13.4V11.9C19.13 11.74 18.29 11.67 17.5 11.67C16.22 11.67 15.05 11.82 14 12.12V13.69M14 11C14.96 10.67 16.12 10.5 17.5 10.5C18.41 10.5 19.26 10.59 20 10.78V9.23C19.13 9.08 18.29 9 17.5 9C16.18 9 15 9.15 14 9.46V11Z" />
                  {% elif reftype == "blog" %}
                  <path fill="currentColor" d="M19 5V19H5V5H19M21 3H3V21H21V3M17 17H7V16H17V17M17 15H7V14H17V15M17 12H7V7H17V12Z" />
                  {% elif reftype == "image" %}
                  <path fill="currentColor" d="M19,19H5V5H19M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M13.96,12.29L11.21,15.83L9.25,13.47L6.5,17H17.5L13.96,12.29Z" />
                  {% elif reftype == "video" %}
                  <path fill="currentColor" d="M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M10,16.5L16,12L10,7.5V16.5Z" />
                  {% elif reftype == "video-list" %}
                  <path fill="currentColor" d="M4 6H2V20C2 21.1 2.9 22 4 22H18V20H4V6M20 4V16H8V4H20M20 2H8C6.9 2 6 2.9 6 4V16C6 17.1 6.9 18 8 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2M12 14.5V5.5L18 10L12 14.5Z" />
                  {% elif reftype == "game" %}
                  <path fill="currentColor" d="M6,9H8V11H10V13H8V15H6V13H4V11H6V9M18.5,9A1.5,1.5 0 0,1 20,10.5A1.5,1.5 0 0,1 18.5,12A1.5,1.5 0 0,1 17,10.5A1.5,1.5 0 0,1 18.5,9M15.5,12A1.5,1.5 0 0,1 17,13.5A1.5,1.5 0 0,1 15.5,15A1.5,1.5 0 0,1 14,13.5A1.5,1.5 0 0,1 15.5,12M17,5A7,7 0 0,1 24,12A7,7 0 0,1 17,19C15.04,19 13.27,18.2 12,16.9C10.73,18.2 8.96,19 7,19A7,7 0 0,1 0,12A7,7 0 0,1 7,5H17M7,7A5,5 0 0,0 2,12A5,5 0 0,0 7,17C8.64,17 10.09,16.21 11,15H13C13.91,16.21 15.36,17 17,17A5,5 0 0,0 22,12A5,5 0 0,0 17,7H7Z" />
                  {% elif reftype == "user" %}
                  <path fill="currentColor" d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,6A2,2 0 0,0 10,8A2,2 0 0,0 12,10A2,2 0 0,0 14,8A2,2 0 0,0 12,6M12,13C14.67,13 20,14.33 20,17V20H4V17C4,14.33 9.33,13 12,13M12,14.9C9.03,14.9 5.9,16.36 5.9,17V18.1H18.1V17C18.1,16.36 14.97,14.9 12,14.9Z" />
                  {% elif reftype == "repository" %}
                  <path fill="currentColor" d="M6,2H18A2,2 0 0,1 20,4V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2M12.75,13.5C15.5,13.5 16.24,11.47 16.43,10.4C17.34,10.11 18,9.26 18,8.25C18,7 17,6 15.75,6C14.5,6 13.5,7 13.5,8.25C13.5,9.19 14.07,10 14.89,10.33C14.67,11 14,12 12,12C10.62,12 9.66,12.35 9,12.84V8.87C9.87,8.56 10.5,7.73 10.5,6.75C10.5,5.5 9.5,4.5 8.25,4.5C7,4.5 6,5.5 6,6.75C6,7.73 6.63,8.56 7.5,8.87V15.13C6.63,15.44 6,16.27 6,17.25C6,18.5 7,19.5 8.25,19.5C9.5,19.5 10.5,18.5 10.5,17.25C10.5,16.32 9.94,15.5 9.13,15.18C9.41,14.5 10.23,13.5 12.75,13.5M8.25,16.5A0.75,0.75 0 0,1 9,17.25A0.75,0.75 0 0,1 8.25,18A0.75,0.75 0 0,1 7.5,17.25A0.75,0.75 0 0,1 8.25,16.5M8.25,6A0.75,0.75 0 0,1 9,6.75A0.75,0.75 0 0,1 8.25,7.5A0.75,0.75 0 0,1 7.5,6.75A0.75,0.75 0 0,1 8.25,6M15.75,7.5A0.75,0.75 0 0,1 16.5,8.25A0.75,0.75 0 0,1 15.75,9A0.75,0.75 0 0,1 15,8.25A0.75,0.75 0 0,1 15.75,7.5Z" />
                  {% elif reftype == "presentation" %}
                  <path fill="currentColor" d="M2,3H10A2,2 0 0,1 12,1A2,2 0 0,1 14,3H22V5H21V16H15.25L17,22H15L13.25,16H10.75L9,22H7L8.75,16H3V5H2V3M5,5V14H19V5H5M11.85,11.85C11.76,11.94 11.64,12 11.5,12A0.5,0.5 0 0,1 11,11.5V7.5A0.5,0.5 0 0,1 11.5,7C11.64,7 11.76,7.06 11.85,7.15L13.25,8.54C13.57,8.86 13.89,9.18 13.89,9.5C13.89,9.82 13.57,10.14 13.25,10.46L11.85,11.85Z" />
                  {% elif reftype == "wikipedia" %}
                  <path fill="currentColor" d="M14.97,18.95L12.41,12.92C11.39,14.91 10.27,17 9.31,18.95C9.3,18.96 8.84,18.95 8.84,18.95C7.37,15.5 5.85,12.1 4.37,8.68C4.03,7.84 2.83,6.5 2,6.5C2,6.4 2,6.18 2,6.05H7.06V6.5C6.46,6.5 5.44,6.9 5.7,7.55C6.42,9.09 8.94,15.06 9.63,16.58C10.1,15.64 11.43,13.16 12,12.11C11.55,11.23 10.13,7.93 9.71,7.11C9.39,6.57 8.58,6.5 7.96,6.5C7.96,6.35 7.97,6.25 7.96,6.06L12.42,6.07V6.47C11.81,6.5 11.24,6.71 11.5,7.29C12.1,8.53 12.45,9.42 13,10.57C13.17,10.23 14.07,8.38 14.5,7.41C14.76,6.76 14.37,6.5 13.29,6.5C13.3,6.38 13.3,6.17 13.3,6.07C14.69,6.06 16.78,6.06 17.15,6.05V6.47C16.44,6.5 15.71,6.88 15.33,7.46L13.5,11.3C13.68,11.81 15.46,15.76 15.65,16.2L19.5,7.37C19.2,6.65 18.34,6.5 18,6.5C18,6.37 18,6.2 18,6.05L22,6.08V6.1L22,6.5C21.12,6.5 20.57,7 20.25,7.75C19.45,9.54 17,15.24 15.4,18.95C15.4,18.95 14.97,18.95 14.97,18.95Z" />
                  {% else %}
                  <!-- no icon for u -->
                  {% endif %}
                </svg>
                {% for tag in reference | get(key="tags", default=[]) %}
                  <span class=tag>#{{tag}}</span>
                {% endfor %}
                <h5 class=card-title>
                  <a class=card-link target="_blank" href="{{reference.url}}" id="{{refname}}">
                    {% if reference.title %}
                    {{reference.title}}
                    {% elif reference.url %}
                    {{reference.url}}
                    {% else %}
                    REF_TITLE_MISSING
                    {% endif %}
                  </a>
                </h5>
                <code class=card-subtitle>{{refname}}</code>
              </header>
              {% if reference.dead %}
              <main class="card-body">
                <strong>Dead Link:</strong> {{reference | get(key="dead", default="") | markdown(inline=true) }}
              </main>
              {% elif reference.desc %}
              <main class="card-body">
                {{ reference | get(key="desc", default="") | markdown }}
              </main>
              {% endif %}
              <!--
                <footer></footer>
              -->
            </section>
          {% else %}
            <!-- References list is empty?! -->
          {% endfor %}</div>
            <script>(function() {
              function debounce(func, timeout = 300) {
                let timer;
                return (...args) => {
                  clearTimeout(timer);
                  timer = setTimeout(() => { func.apply(this, args); }, timeout);
                };
              }
              /** @type HTMLElement[] */
              let searchtable = Array.from(document.querySelectorAll("#references > .js-ref"));
              console.log(searchinput);
              console.log(searchtable);
              searchinput.oninput = debounce(() => {
                /** @type string */
                let query = searchinput.value || '';
                if(!query || query.length < 3) {
                  searchtable.map(e => e.classList.remove('d-none'));
                  return;
                }
                
                let slug = query.toLowerCase().trim();
                slug = slug.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                slug = slug.replace(/[^a-z0-9\s-]/g, ' ').trim();
                slug = slug.replace(/[\s-]+/g, '-');
                
                let count = searchtable.map(e =>
                  e.classList.toggle('d-none', !(
                    (e.dataset.url||'http://').startsWith(query)
                    || (e.dataset.url||'').includes(query, 6)
                    || (e.dataset.slug||'').includes(slug)
                    || (e.dataset.hostSlug||'').includes(slug)
                    || (e.dataset.pathSlug||'').includes(slug)
                    || (e.dataset.tags||'').includes(slug)
                    || (e.dataset.author||'').includes(slug)
                    || (e.dataset.type||'').includes(slug)
                  ))
                ).filter(b=>!b).length;
              });
              
              searchinput.style.display = '';
              searchinput.focus();
            })();</script>
        </article>
      </div>
    </div>
  </div>
</div>
{% endblock content %}
